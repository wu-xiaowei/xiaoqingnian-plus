(window.webpackJsonp=window.webpackJsonp||[]).push([[277],{583:function(a,t,s){"use strict";s.r(t);var i=s(4),e=Object(i.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"我用这个技术-干掉几千行-if-else"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#我用这个技术-干掉几千行-if-else"}},[a._v("#")]),a._v(" 我用这个技术，干掉几千行 if else！")]),a._v(" "),t("blockquote",[t("p",[a._v("本文作者："),t("a",{attrs:{href:"https://yuyuanweb.feishu.cn/wiki/Abldw5WkjidySxkKxU2cQdAtnah",target:"_blank",rel:"noopener noreferrer"}},[a._v("程序员鱼皮"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("本站地址："),t("a",{attrs:{href:"https://codefather.cn",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://codefather.cn"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("大家好我是鱼皮，今天我将用一个有趣的小例子来带大家入门企业开发中非常实用的技术—— 工作流，用好这个技术，可以帮你消除项目中大量的 if else 代码，让你的项目更好维护和扩展。")]),a._v(" "),t("blockquote",[t("p",[a._v("本文视频演示：https://www.bilibili.com/video/BV13d4y1o7iB/")])]),a._v(" "),t("h2",{attrs:{id:"什么是工作流"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是工作流"}},[a._v("#")]),a._v(" 什么是工作流？")]),a._v(" "),t("p",[a._v("工作流顾名思义，就是一系列工作所组成的流程。")]),a._v(" "),t("p",[a._v("就像工厂加工产品一样，确认好生产步骤后，所有工人只需做好自己的事情即可。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936772.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("比如我现在要做一个养鸡系统，  每一只鸡都需要依次通过唱、跳、RAP、篮球的考核，并且还要练习时长两年半，才能出售，否则就算是 “蔡鸡”，要打回去重新练习。")]),a._v(" "),t("p",[a._v("对应的流程图如下：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936938.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("那如果让你来写代码实现这个逻辑，你会怎么写呢？")]),a._v(" "),t("p",[a._v("想必会是一大段的 if ... else ... 吧，像下面这样：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936288.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("对于简单的程序来说，这样写没有问题。但在企业开发中，我们的业务流程往往是非常复杂的，比如下面这个系统：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936028.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("再加上多人协作开发，大家都在一个文件里写 if else 也不现实。")]),a._v(" "),t("p",[a._v("所以为了更好地开发和维护工作流，我们一般会使用 "),t("code",[a._v("工作流引擎")]),a._v(" 技术。可以通过可视化拖拽的方式来绘制流程图、并自动生成业务流程代码，而不用自己写 if else，大幅降低开发成本、非程序员也能用。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936616.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("可视化绘制工作流")])]),a._v(" "),t("p",[a._v("比较成熟的工作流引擎有 Activiti、flowable-engine 等等，但它们都需要一些学习成本，对于第一次接触工作流的同学来说，可能会有点复杂。")]),a._v(" "),t("p",[a._v("所以我选了一个相对轻量纯净的工作流引擎 CompileFlow 来演示，便于大家理解。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936699.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("下面我们用它来实现刚刚提到的养鸡系统。")])]),a._v(" "),t("h2",{attrs:{id:"工作流实现养鸡系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作流实现养鸡系统"}},[a._v("#")]),a._v(" 工作流实现养鸡系统")]),a._v(" "),t("h3",{attrs:{id:"_1、准备操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备操作"}},[a._v("#")]),a._v(" "),t("strong",[a._v("1、准备操作")])]),a._v(" "),t("p",[a._v("使用 Compile Flow 非常简单，直接进入代码仓库主页，引入代码包即可：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936185.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("这里我建议大家首次使用时下载官方提供的示例代码：https://github.com/compileflow/compileflow-demo")]),a._v(" "),t("p",[a._v("这是一个 Maven + Spring Boot 的项目，我们用 IDEA 开发工具打开它，可以看到目录中有很多 bpm 业务流程管理文件，用来定义我们的工作流。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936179.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("但是 bpm 文件是用 XML 编写的，看着就很复杂，真要自己写这个玩意还不如写 if else 呢！")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936934.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("bpm 文件")])]),a._v(" "),t("p",[a._v("所以我们要先下载一个 "),t("code",[a._v("Compileflow Designer")]),a._v(" 插件，这样就能可视化地编辑工作流了：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936329.png",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"_2、新建项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、新建项目"}},[a._v("#")]),a._v(" "),t("strong",[a._v("2、新建项目")])]),a._v(" "),t("p",[a._v("让我们在资源目录下新建一个 bpm 文件，就叫 "),t("code",[a._v("ji.bpm")]),a._v("，然后点编辑器底部切换到可视化编辑视图。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936814.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("在这里，我们就能像画流程图一样设计我们的程序流程了，让我们试着复现一下之前画的流程图。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936325.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("可视化编辑流程")])]),a._v(" "),t("p",[a._v("左边的内容称为 "),t("code",[a._v("节点")]),a._v(" ，每个流程图必须包含一个开始和一个结束节点，不同的节点有不同的流程控制规则。")]),a._v(" "),t("p",[a._v("节点又可以指向其他节点，表示工作的执行顺序，双击节点可以编辑节点名称：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936076.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("编辑节点")])]),a._v(" "),t("p",[a._v("一番操作后，我们的流程图就变成了下面这个样子：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936081.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("但目前这个流程图是静态的，我们需要给它绑定数据和程序代码，来让整个流程动起来。")]),a._v(" "),t("h3",{attrs:{id:"_3、绑定数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、绑定数据"}},[a._v("#")]),a._v(" "),t("strong",[a._v("3、绑定数据")])]),a._v(" "),t("p",[a._v("我们要先确定整个流程的输入和输出，此处我们的输入就是一只鸡（Ji 对象）、输出是考核结果（boolean 类型），我们把这些信息叫做工作流的 "),t("code",[a._v("上下文")]),a._v(" 。可以理解为全局变量，工作流的每个节点都可以读取这些数据。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936430.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("确定上下文")])]),a._v(" "),t("p",[a._v("双击编辑器空白处，就可以配置上下文。这里要注意选择 inOutType 的值，全局入参为 param、全局返回值为 result，如果你需要在部分节点中传递变量，可以用 inner 类型。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936444.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("全局上下文配置")])]),a._v(" "),t("h3",{attrs:{id:"_4、绑定方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、绑定方法"}},[a._v("#")]),a._v(" "),t("strong",[a._v("4、绑定方法")])]),a._v(" "),t("p",[a._v("配置好上下文后，我们要给每个节点绑定一个方法，也就是这个节点要做什么事。")]),a._v(" "),t("p",[a._v("这里我们从之前的 if else 程序中提取出需要的方法，每个分支都是一个独立的方法，比如 checkChang、考核成功、考核失败等：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936586.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("每个节点一个方法")])]),a._v(" "),t("p",[a._v("然后双击流程图中的节点，点击行为配置，选择我们的方法，配置输入参数和返回值。这里我们的输入参数从上下文中获取，返回值同步给上下文，配置如图：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936736.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("绑定方法")])]),a._v(" "),t("h3",{attrs:{id:"_5、绑定条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、绑定条件"}},[a._v("#")]),a._v(" "),t("strong",[a._v("5、绑定条件")])]),a._v(" "),t("p",[a._v("最后我们还要再给判断节点绑定条件，区分 yes 或 no。")]),a._v(" "),t("p",[a._v("单击箭头，然后输入表达式，如果表达式成立，那么会往下执行，还可以配置优先级来选择判断顺序（类似代码中 if else 的顺序）：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936532.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("绑定条件")])]),a._v(" "),t("h3",{attrs:{id:"_6、执行流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、执行流程"}},[a._v("#")]),a._v(" "),t("strong",[a._v("6、执行流程")])]),a._v(" "),t("p",[a._v("至此，我们的流程图就编辑完了，然后我们就可以在代码中执行流程。")]),a._v(" "),t("p",[a._v("比如我这里新建一个 main 方法，new 一只鸡，作为输入参数放到流程上下文中，然后调用流程引擎的 start 方法，就能得到结果了。")]),a._v(" "),t("p",[a._v("示例代码如下：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('public static void main(String[] args) {\n  // 输入一只鸡\n  Ji ji = new Ji();\n  ji.setName("cai");\n  ji.setCanChang(true);\n  ji.setCanTiao(true);\n  ji.setCanRap(true);\n  ji.setCanLanQiu(true);\n  ji.setPracticeYear(2.5D);\n  // 找到 bpm 文件的位置\n  String code = "bpm.ji";\n\n  // 设置上下文（输入参数）\n  Map<String, Object> context = new HashMap<>();\n  context.put("ji", ji);\n\n  try {\n    // 执行流程\n    ProcessEngine processEngine = ProcessEngineFactory.getProcessEngine();\n    Map<String, Object> result = processEngine.start(code, context);\n    // 获取结果\n    System.out.println(result.get("result"));\n  } catch (Exception e) {\n    e.printStackTrace();\n  }\n}\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br")])]),t("p",[a._v("运行一下试试看：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936342.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("大功告成，以上就是工作流引擎的用法了。")]),a._v(" "),t("p",[a._v("不过由于这个例子比较简单，可能无法突出工作流引擎的优势，这也说明了一点：任何技术都要结合实际场景来选择是否运用。")]),a._v(" "),t("p",[a._v("一般工作流引擎在 ERP 系统、OA 系统中用的比较多，那大家感兴趣的话也可以试着完成 demo 项目中更复杂的例子 "),t("code",[a._v("orderFulfillmentFlow.bpm")]),a._v(" ，感受工作流引擎开发的高效。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936938.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("更复杂的例子")])]),a._v(" "),t("h2",{attrs:{id:"原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),t("p",[a._v("Compile Flow 工作流引擎的原理其实也很 “简单”，就是将用户编辑好的 XML 视图文件编译为 Java 代码。我们点开编译后的 Java 代码就可以看到全局变量、流程等等：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936689.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("虽然说还是用到了 if else，但是开发者不需要关心这些 if else 了，定义好流程、写好每个节点要做的工作即可。")]),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("最后补充一句，Compile Flow 其实好久没更新了，文档写的也过于精简。我只是为了便于大家理解，给大家演示使用。如果你想系统地学习或在企业开发中使用工作流，还是更推荐 Activiti 等成熟的，国产好用的工作流引擎也很多。")]),a._v(" "),t("p",[a._v("以上就是本期分享，学会的朋友们点个赞吧，之后大家如果忘了工作流，就想想唱跳 RAP 篮球。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080936683.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("欢迎学编程的朋友们加入我的 "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzI1NDczNTAwMA==&mid=2247521173&idx=1&sn=00e79de2ac253248e33c764f137e317b&chksm=e9c27462deb5fd747092c34d1bff990102cab5df7733d95ee21f5b0090b398b8f3d79c293e6c&token=1288511242&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[a._v("编程知识星球"),t("OutboundLink")],1),a._v(" （点击了解详情），一起学习进步~")])])}),[],!1,null,null,null);t.default=e.exports}}]);