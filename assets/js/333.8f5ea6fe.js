(window.webpackJsonp=window.webpackJsonp||[]).push([[333],{637:function(a,t,v){"use strict";v.r(t);var _=v(4),s=Object(_.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"啥是重定向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#啥是重定向"}},[a._v("#")]),a._v(" 啥是重定向？")]),a._v(" "),t("blockquote",[t("p",[a._v("本文作者："),t("a",{attrs:{href:"https://yuyuanweb.feishu.cn/wiki/Abldw5WkjidySxkKxU2cQdAtnah",target:"_blank",rel:"noopener noreferrer"}},[a._v("程序员鱼皮"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("本站地址："),t("a",{attrs:{href:"https://codefather.cn",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://codefather.cn"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("大家好，我是鱼皮，今天分享 "),t("code",[a._v("重定向")]),a._v(" 小知识，以及我在腾讯云云开发中实现域名重定向的实践。")]),a._v(" "),t("h3",{attrs:{id:"孽起"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#孽起"}},[a._v("#")]),a._v(" 孽起")]),a._v(" "),t("p",[a._v("之前，我开发了一个编程导航网站，将网站放到了腾讯云云开发上，用云托管（容器）的方式部署和维护。还购买了一个域名 "),t("code",[a._v("code-nav.cn")]),a._v("，并且在云开发后台 "),t("code",[a._v("访问服务")]),a._v(" 中，将该域名的子域名 "),t("code",[a._v("www.code-nav.cn")]),a._v(" 和存放网站文件的容器相关联，配置如图：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071347374.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("云开发网站访问配置")])]),a._v(" "),t("p",[a._v("然后，大家就能通过网址 "),t("code",[a._v("www.code-nav.cn")]),a._v(" 访问该网站了。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346677.png",loading:"lazy"}}),a._v("访问网站")]),a._v(" "),t("p",[a._v("但是，很快，我就发现了一个严重的问题。")]),a._v(" "),t("p",[a._v("有不少同学想要访问我的网站，但是，由于他们输入的网址是 "),t("code",[a._v("code-nav.cn")]),a._v("，省略了网址前缀 "),t("code",[a._v("www")]),a._v("，导致网站无法访问。也让我流失了一批用户。")]),a._v(" "),t("p",[a._v("###初战 —— 域名配置")]),a._v(" "),t("p",[a._v("要解决这个问题，其实很简单，之前是配置 "),t("code",[a._v("www")]),a._v(" 子域名指向容器，那在云开发后台再加一条配置，直接将购买的域名（父域名）"),t("code",[a._v("code-nav.cn")]),a._v(" 也指向容器，不就成了么？")]),a._v(" "),t("p",[a._v("配置如下：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346087.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("云开发网站访问配置")])]),a._v(" "),t("p",[a._v("这样，无论用户是否输入 "),t("code",[a._v("www")]),a._v(" 前缀，都能够访问到我们的网站啦！")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346824.png",loading:"lazy"}}),a._v("访问网站")]),a._v(" "),t("p",[a._v("看似非常完美，但目前，"),t("strong",[a._v("网站其实还存在一定问题")]),a._v("。")]),a._v(" "),t("h3",{attrs:{id:"现存问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#现存问题"}},[a._v("#")]),a._v(" 现存问题")]),a._v(" "),t("p",[a._v("首先，带 www 与不带 www 其实是两个不同的网址，虽然对用户来说，感觉是访问了同一个网站。但对于搜索引擎，小蜘蛛们会把他们识别为两个不同的网站，并且分别收录这两个路径下网站的内容，导致权重分散。虽然对流量小的网站来说影响不大，但对于大站点，这是必须要处理的问题。")]),a._v(" "),t("p",[a._v("此外，访问 "),t("code",[a._v("code-nav.cn")]),a._v("（不带 www）的用户反映，网站上的数据无法加载。这是因为，腾讯云云开发的 WEB 安全域名限制，只有在白名单内的域名才允许访问云资源（数据、文件等），因此，还要在 "),t("code",[a._v("安全配置")]),a._v(" 中，补上 "),t("code",[a._v("code-nav.cn")]),a._v(" 域名。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346212.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("云开发安全配置")])]),a._v(" "),t("p",[a._v("虽然现在访问正常了，但是如果业务中还有一些和 www 网址强相关的逻辑，比如判断用户访问的网址必须是 "),t("code",[a._v("www.code-nav.cn")]),a._v(" 才允许登录，那么你还要去修改代码，考虑稍有不周，就会导致一些功能出现问题。")]),a._v(" "),t("p",[a._v("为解决这些问题，我们可以使用 "),t("code",[a._v("重定向")]),a._v(" 技术。")]),a._v(" "),t("h3",{attrs:{id:"重定向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重定向"}},[a._v("#")]),a._v(" 重定向")]),a._v(" "),t("p",[a._v("重定向是一个很广泛的概念，即通过各种方法将各种网络请求重新定个方向转到其它位置，比如网页重定向、域名重定向、数据报文重定向等。")]),a._v(" "),t("p",[a._v("在网站开发中，重定向的应用场景太多了，比如用户未登录时，将它输入的网址自动跳转为登录页；用户访问旧版网址时，自动跳转到新版网页。"),t("strong",[a._v("重定向不仅是导游，也是一名霸道的保安。")])]),a._v(" "),t("p",[a._v("因此，很多大站点都会采用重定向技术。比如访问百度 "),t("code",[a._v("baidu.com")]),a._v("，按 F12 查看开发者控制台，可以看到网址通过 302 重定向，自动跳转为了 "),t("code",[a._v("www.baidu.com")]),a._v("。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346576.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("重定向")])]),a._v(" "),t("p",[a._v("那问题就来了，啥是 302 重定向？")]),a._v(" "),t("p",[a._v("不妨看一看常见的重定向 HTTP 状态码。")]),a._v(" "),t("h4",{attrs:{id:"重定向-http-状态码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重定向-http-状态码"}},[a._v("#")]),a._v(" 重定向 HTTP 状态码")]),a._v(" "),t("p",[a._v("和重定向有关的 HTTP 状态码主要是 301、302、303、307、308，最常用的是 301 和 302，可以看看 MDN 官方对它们的解释。")]),a._v(" "),t("p",[a._v("301 是永久重定向（Moved Permanently）说明请求的资源已经被 "),t("strong",[a._v("永久")]),a._v(" 移动到了由 Location 头部指定的 url 上，是固定的不会再改变，搜索引擎会根据该响应修正。")]),a._v(" "),t("p",[a._v("而 302 是暂时性转移（Moved Temporarily，或者 Found），表明请求的资源被 "),t("strong",[a._v("暂时")]),a._v(" 移动到了由 Location 头部指定的 URL 上。浏览器会重定向到这个 URL， 但是搜索引擎不会对该资源的链接进行更新。")]),a._v(" "),t("p",[a._v("虽然 301 和 302 都能够将用户输入的网址 A， 改为重定向后的网址 B，但他们还是有区别的：")]),a._v(" "),t("ul",[t("li",[a._v("搜索引擎区别：301 表示原地址 A 的资源已被移除，永远无法访问，搜索引擎抓内容时会将网址 A 全部替换为 B；而 302 表示网址 A 还活着，搜索引擎会在抓取网址 B 新内容的同时，保留网址 A 的记录。")]),a._v(" "),t("li",[a._v("安全性：302 跳转有网站劫持的风险，导致网站被盗用。")])]),a._v(" "),t("h3",{attrs:{id:"再战-云开发重定向实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#再战-云开发重定向实践"}},[a._v("#")]),a._v(" 再战 —— 云开发重定向实践")]),a._v(" "),t("p",[a._v("了解重定向之后，来试试怎么实现重定向，以及如何在云开发中实现域名重定向。")]),a._v(" "),t("p",[a._v("实现重定向的方式有很多，很大程度上依赖于你使用的 web 服务器，比如 Nginx、Apache、Tomcat 等，一般在服务器中添加几条配置即可。")]),a._v(" "),t("p",[a._v("我的编程导航网站是以容器的方式，部署在云开发提供的云托管功能上的。我把开发好的网站文件和提供 web 服务的 Nginx 服务器一起打包，做成了容器，于是，可以将每个容器当成一个小服务器，独立运行。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346574.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("要支持重定向，只需要修改下 Nginx 的配置。比如这里我选择给整个网站添加 301 永久重定向，配置文件如下：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('server {\n  listen 80;\n  # gzip config\n  gzip on;\n  ...\n\n  root /usr/share/nginx/html;\n  include /etc/nginx/mime.types;\n\n  # 添加重定向\n  if ($http_host ~ "^code-nav.cn") {\n    rewrite  ^(.*)    https://www.code-nav.cn permanent;\n  }\n}\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br")])]),t("p",[a._v("不必手写和记忆 Nginx 配置，直接使用可视化界面生成即可：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346549.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("Nginx 可视化配置")])]),a._v(" "),t("p",[a._v("详情参见这篇文章："),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzg2NjU1MjU5Ng==&mid=2247484369&idx=1&sn=da9d7ee4a589cfab9eb7ab0f629f3211&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[a._v("轻松搞定 Nginx 配置代码的神器！"),t("OutboundLink")],1)]),a._v(" "),t("p",[t("em",[a._v("其他的服务器配置也可以自行查阅文档，这里不再赘述。")])]),a._v(" "),t("p",[a._v("然后，在云托管上创建新版本，发布新的容器，就大功告成啦！")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346106.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("新建版本")])]),a._v(" "),t("p",[a._v("查看下效果，访问 "),t("code",[a._v("code-nav.cn")]),a._v("，网站重定向到了 "),t("code",[a._v("www.code-nav.cn")]),a._v("，完美！")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346429.png",loading:"lazy"}})]),a._v(" "),t("blockquote",[t("p",[a._v("查看网络请求")])]),a._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),t("p",[a._v("最后，回顾下在腾讯云云开发中实现域名重定向的完整过程，包括如下步骤：")]),a._v(" "),t("ol",[t("li",[a._v("在 "),t("code",[a._v("访问服务")]),a._v(" 中添加父域名到网站的指向（云托管等）")]),a._v(" "),t("li",[a._v("在 "),t("code",[a._v("安全配置")]),a._v(" 中添加父域名到白名单中")]),a._v(" "),t("li",[a._v("在 web 服务器中添加重定向配置")]),a._v(" "),t("li",[a._v("新建版本，部署发布")])]),a._v(" "),t("p",[a._v("整个流程还是非常简单的~")]),a._v(" "),t("p",[a._v("如果本文对大家有帮助，请一定要给个 "),t("strong",[a._v("点赞 + 在看")]),a._v(" 支持呀！❤️")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071346681.png",loading:"lazy"}})])])}),[],!1,null,null,null);t.default=s.exports}}]);