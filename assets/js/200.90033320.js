(window.webpackJsonp=window.webpackJsonp||[]).push([[200],{502:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"自制-ai-问答机器人"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自制-ai-问答机器人"}},[s._v("#")]),s._v(" 自制 AI 问答机器人")]),s._v(" "),a("blockquote",[a("p",[s._v("本文作者："),a("a",{attrs:{href:"https://yuyuanweb.feishu.cn/wiki/Abldw5WkjidySxkKxU2cQdAtnah",target:"_blank",rel:"noopener noreferrer"}},[s._v("程序员鱼皮"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("本站地址："),a("a",{attrs:{href:"https://codefather.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://codefather.cn"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("大家好，我是鱼皮，自从做了知识分享，我的微信就没消停过，平均每天会收到几百个消息，大部分都是学编程的朋友向我咨询编程问题。")]),s._v(" "),a("p",[s._v("但毕竟我只有一个人，没法所有消息都一个个回复，所以也是很愧疚和无力吧；另外我发现，大家的很多问题是重复的，而且大多数我都专门写文章来回答过。")]),s._v(" "),a("p",[s._v("所以，我决定自制一个 AI 问答机器人，帮我自动回复大家的常见问题，减少重复工作。")]),s._v(" "),a("p",[s._v("结果没想到，制作过程中被 Bug 坑惨了，闹了不少笑话，感兴趣的朋友可以看看视频哈哈：")]),s._v(" "),a("blockquote",[a("p",[s._v("地址：https://www.bilibili.com/video/BV1Vq4y1B7zu/")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817273.png",loading:"lazy"}})]),s._v(" "),a("p",[s._v("由于制作方法实在太简单，所以给大家分享下完整的教程，让大家也能轻松制作自己的 AI 机器人。")]),s._v(" "),a("h3",{attrs:{id:"自制-ai-机器人教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自制-ai-机器人教程"}},[s._v("#")]),s._v(" 自制 AI 机器人教程")]),s._v(" "),a("blockquote",[a("p",[s._v("预计整个制作过程 10 分钟")])]),s._v(" "),a("p",[s._v("先描述下需求：做一个能够自动回答微信消息的机器人。")]),s._v(" "),a("p",[s._v("要实现这个需求，有两个要点：")]),s._v(" "),a("ol",[a("li",[s._v("如何让程序接收到微信发来的消息？")]),s._v(" "),a("li",[s._v("如何根据消息来回复对应的内容？")])]),s._v(" "),a("p",[s._v("这两个问题，如果没有一定的专业知识，是很难自行解决的。但如今是开源的时代，我们可以站在巨人的肩膀上，用现成的技术来解决这些问题。")]),s._v(" "),a("h4",{attrs:{id:"接受消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接受消息"}},[s._v("#")]),s._v(" 接受消息")]),s._v(" "),a("p",[s._v("可以使用开源的 "),a("code",[s._v("wechaty")]),s._v(" 库来实现对微信的自动化操作，比如收发消息、通过好友、拉群等。")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817787.png",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("开源微信机器人库")])]),s._v(" "),a("p",[s._v("使用方法很简单，在 wechaty 仓库的项目介绍文件中，有最简单的入门示例代码，只需要 "),a("strong",[s._v("6 行代码")]),s._v(" ，就能启动一个帮你接受消息的机器人！")]),s._v(" "),a("p",[s._v("wechaty 支持几乎所有主流的编程语言，其中 JavaScript 的入门代码如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import { WechatyBuilder } from 'wechaty'\n// 启动\nWechatyBuilder.build()\n  .on('scan', (qrcode, status) => console.log(`Scan QR Code to login: ${status}\\nhttps://wechaty.js.org/qrcode/${encodeURIComponent(qrcode)}`))\n  .on('login',            user => console.log(`User ${user} logged in`))\n  .on('message',       message => console.log(`Message: ${message}`))\n  .start()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("解释一下上述代码，你会发现，wechaty 中定义了很多事件，比如扫码、用户登录、接受消息、接受好友请求等。你不需要关心事件是如何被它触发的，只需要针对不同事件来编写处理方法就好，比如收到消息后自动回复同样的消息，示例代码如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 初始化机器人\nconst bot = WechatyBuilder.build({\n  name: 'yupi-wxrobot',\n  // 用于兼容不同 IM 协议，不用关心\n  puppet: 'wechaty-puppet-wechat',\n})\n// 处理消息\nbot.on('message', async function (msg) {\n  // 获取消息发送人\n  const contact = msg.talker()\n  // 获取消息内容\n  const text = msg.text()\n  // 获取群聊信息\n  const room = msg.room()\n  // 是私聊\n  if (contact && text) {\n    // 回复相同内容\n    msg.say(text, contact);\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("但是，大家 "),a("strong",[s._v("千万不要")]),s._v(" 直接运行上述代码！因为一旦你启动了机器人、又没有限制回复者昵称的话，它会对所有给你发消息的人生效！")]),s._v(" "),a("p",[s._v("我刚开始没注意，就被坑了。。。")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817116.png",loading:"lazy"}})]),s._v(" "),a("p",[s._v("所以，如果你只想自动回复某人或某群聊的消息，记得在代码中补充相应的过滤逻辑，比如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 处理消息\nbot.on('message', async function (msg) {\n  // 获取消息发送人\n  const contact = msg.talker()\n  // 获取消息内容\n  const text = msg.text()\n  // 获取群聊信息\n  const room = msg.room()\n\n  // 不处理自己的消息\n  if (msg.self()) {\n    return\n  }\n  // 群聊还是私聊\n  if (room) {\n    if(room.topic() === '鱼皮群') {\n      // 回复\n    }\n  } else {\n    if(contact.name() === '小号') {\n      // 回复\n    }\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("OK，使用上述代码，就能实现接受消息和自动回复啦！")]),s._v(" "),a("p",[s._v("那么你是否好奇，wechaty 是如何接受到微信消息的呢？其实原理很简单，执行 wechaty 程序时，它会利用无头浏览器技术悄悄打开一个网页版微信，然后在你运行程序的控制台弹出微信网页版的登录二维码，在你扫码登录后，程序只需要监听页面元素的变化、或者自动触发点击事件即可。")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817760.png",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("网页版微信")])]),s._v(" "),a("p",[s._v("其实道理很简单，就是把我们能对网页进行的人工操作转化为后台自动化执行。")]),s._v(" "),a("h4",{attrs:{id:"智能回复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#智能回复"}},[s._v("#")]),s._v(" 智能回复")]),s._v(" "),a("p",[s._v("第一个问题解决了，那么如何根据不同的问题给出不同的回复呢？")]),s._v(" "),a("p",[s._v("很多同学肯定上来就说 AI，那都是被我用的 “智能” 一次带偏了。其实如果只是简单的自动回复，问题规则可收敛、可枚举的情况下，直接用 "),a("code",[s._v("if ... else ...")]),s._v(" 就能解决了！")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("if(/你好/.test(text)) {\n  msg.say('好的');\n} else if (/谢谢/.test(text)) {\n  msg.say('不客气');\n} else if (/加群/.test(text)) {\n  msg.say('公众号[程序员鱼皮],回复[加群]');\n} else {\n  msg.say('我不懂');\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("不是说人工智能的本质就是 if else 么哈哈，只不过是让机器来帮你去做 if else 而已。")]),s._v(" "),a("p",[s._v("但现实是，我的读者对于同一个问题也会有不同的表达方式，比如 “怎么学 Java？”、“我想学 Java，怎么学？” 等等。因此，还是需要人工智能登场了。")]),s._v(" "),a("p",[s._v("到哪里去搞人工智能呢？")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817832.png",loading:"lazy"}})]),s._v(" "),a("p",[s._v("我们可以直接利用 "),a("code",[s._v("微信对话开放平台")]),s._v(" 提供的强大能力，一行代码都不用写，就能免费实现智能对话！")]),s._v(" "),a("blockquote",[a("p",[s._v("地址：https://openai.weixin.qq.com/")])]),s._v(" "),a("p",[s._v("登录后先创建一个机器人：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817813.png",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("创建机器人")])]),s._v(" "),a("p",[s._v("然后可以为机器人添加技能，你可以自定义技能，向机器人灌输指定的问题和回答；也可以直接使用平台提供的默认技能，比如听歌、聊天、百科等：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817030.png",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("配置技能")])]),s._v(" "),a("p",[s._v("我的需求是自动回答读者的编程相关问题，因此需要创建一个新技能。在这里，可以灵活地自定义题目、不同的问法以及回答，全部用界面操作即可，轻松打造你的专属机器人：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817014.png",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("自定义技能")])]),s._v(" "),a("p",[s._v("配置好之后，就可以发布和使用机器人了。我们可以将机器人和公众号 / 小程序绑定，自动回复读者消息；可以直接在 H5 网页中接入智能客服；还可以在程序中调用开放接口来使用智能对话能力：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817055.png",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("发布和使用")])]),s._v(" "),a("p",[s._v("此处我们希望在 wechaty 程序中自动获得回复，所以要使用 "),a("strong",[s._v("开放接口")]),s._v(" 的方式，也很简单，就是用个请求库去调用接口，示例代码如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 获取 API 签名，2小时过期\n// token 需从平台获取\nconst url = `https://openai.weixin.qq.com/openapi/sign/${token}`;\nconst {signature} = (await axios.post(url, {\n    userid: \'test\'\n})).data;\n\n// 调用 AI 接口，获取答案\nasync function getAnswer(userid, text) {\n  const apiUrl = `https://openai.weixin.qq.com/openapi/aibot/${token}`;\n  return (await axios.post(apiUrl, {\n    "signature": signature,\n    "userid": userid,\n    "query": text,\n  })).data?.answer;\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("大概就是这样，又简单又实用，感兴趣的同学可以用它来做出很多有趣的功能~")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("我是鱼皮，周末肝文不易，有帮助的话还希望能给个 "),a("strong",[s._v("点赞 + 在看")]),s._v(" 支持下，谢谢大家。")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311090817776.png",loading:"lazy"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);