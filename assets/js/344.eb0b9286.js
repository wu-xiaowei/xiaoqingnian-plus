(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{603:function(a,t,s){"use strict";s.r(t);var i=s(4),p=Object(i.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"写了7年代码-第一次见这么狗血的小bug"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#写了7年代码-第一次见这么狗血的小bug"}},[a._v("#")]),a._v(" 写了7年代码，第一次见这么狗血的小Bug！")]),a._v(" "),t("blockquote",[t("p",[a._v("本文作者："),t("a",{attrs:{href:"https://yuyuanweb.feishu.cn/wiki/Abldw5WkjidySxkKxU2cQdAtnah",target:"_blank",rel:"noopener noreferrer"}},[a._v("程序员鱼皮"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("本站地址："),t("a",{attrs:{href:"https://codefather.cn",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://codefather.cn"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("刚刚修我们鱼聪明 AI 助手平台的一个 Bug，结局很狗血！赶紧给大家分享一下，顺便也分享下标准的排查 Bug 思路。")]),a._v(" "),t("p",[a._v("事情是这样的，有小伙伴在鱼聪明平台（https://www.yucongming.com）创建了一个 AI 助手，名称为【软件开发人员】。当我搜索 “软件开发” 时，能搜出这个模型：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935716.png",loading:"lazy"}}),a._v("鱼聪明 AI 助手")]),a._v(" "),t("p",[a._v("结果搜索 “软件开发人员”，也就是助手的全名称时，竟然搜不出结果了？！")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935699.png",loading:"lazy"}}),a._v("鱼聪明 AI 助手")]),a._v(" "),t("p",[a._v("遇到这种事，先从前端出发：第一时间确认前端发送的请求参数是否正确。")]),a._v(" "),t("p",[a._v("按 F12 打开网络控制台，发现搜索关键词传的没毛病：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935738.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("然后鱼皮顺着网线爬到后端，先要确认一下从数据库中有没有查出最原始的数据，再考虑是不是被业务代码过滤掉了。")]),a._v(" "),t("p",[a._v("在本地开启数据库的查询日志，用的是 MyBatis Plus 框架，开启日志的代码如下：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mybatis-plus:\n  configuration:\n    map-underscore-to-camel-case: false\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("再次执行搜索，打印出的 SQL 记录如图：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935711.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("把参数拼到 SQL 语句模板中，就是 name like '%软件开发人员%'，看上去没有任何问题。")]),a._v(" "),t("p",[a._v("再次验证，接下来我们把拼接好的 SQL 放到数据库控制台进行真实查询：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935687.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("结果查询结果为 0：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935636.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("奇怪了，难道数据库中没有这条记录？但是为啥搜索 “软件开发” 的时候，能搜出这个助手呢？")]),a._v(" "),t("p",[a._v("然后我又用助手的 id 去数据库中查询，发现确实有名称为 “软件开发人员” 的数据。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935539.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("气了气了，为啥查不出来啊？！大家也可以猜一猜。")]),a._v(" "),t("p",[a._v("这个时候我其实已经有想法了，难道是数据库中存储的 name 和我们看到的 name 格式（或者字符）不一致？于是我就从数据库中把 name 的值复制出来，如图：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935707.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("结果，从数据库中复制出来的 name 作为查询条件，是能查出结果的！")]),a._v(" "),t("p",[a._v("于是就有了下面这张神奇的截图，两个 “一模一样” 的 SQL 语句，一个有结果，一个没结果：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935846.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("基本就可以确认了，此 “软件开发人员” 非彼 “软件开发人员”，这两个字符串是不一致的！")]),a._v(" "),t("p",[a._v("于是我分别用这两个字符串来生成 MD5 Hash 码，发现 Hash 码不同，说明原字符串不同。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935052.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("再进行更精确地对比，发现是 “人” 字不同：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935312.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("坑啊！谁能看出来这两个 “人” 字有区别！")]),a._v(" "),t("p",[a._v("到底有啥区别呢？问下鱼聪明 AI 吧~")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311071935089.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("结果一秒破案：原来第一个 “人” 是全角字符。所以程序本身没有任何 Bug，这真的是泰裤辣！")]),a._v(" "),t("p",[a._v("大概整个案件就是这样。所以说，我们看到得未必是真实的，这个 Bug 让我想起了很多朋友初上大学时经常把中英文逗号、中英文冒号搞混，这种 Bug 真是让人哭笑不得。希望各位程序员朋友们，尽量不要遇到吧，遇到了的话，想想我这篇文章，说不定就有了解决的思路呢。")])])}),[],!1,null,null,null);t.default=p.exports}}]);