(window.webpackJsonp=window.webpackJsonp||[]).push([[271],{576:function(a,n,t){"use strict";t.r(n);var s=t(4),e=Object(s.a)({},(function(){var a=this,n=a._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"实战开发类库-手写-spring-boot-starter"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实战开发类库-手写-spring-boot-starter"}},[a._v("#")]),a._v(" 实战开发类库，手写 Spring Boot Starter！")]),a._v(" "),n("blockquote",[n("p",[a._v("本文作者："),n("a",{attrs:{href:"https://yuyuanweb.feishu.cn/wiki/Abldw5WkjidySxkKxU2cQdAtnah",target:"_blank",rel:"noopener noreferrer"}},[a._v("程序员鱼皮"),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("本站地址："),n("a",{attrs:{href:"https://codefather.cn",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://codefather.cn"),n("OutboundLink")],1)])]),a._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzI1NDczNTAwMA==&mid=2247529515&idx=1&sn=eb5e2af507ce35e3c4159dad7e1424f1&chksm=e9c293dcdeb51acac148fd14c0677ab3c1076c47ab52a33ffe7d682a3e1d1d8f37c4d3c7d167&token=1411297570&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[a._v("最近在带大家做新项目，欢迎参与"),n("OutboundLink")],1)])]),a._v(" "),n("p",[a._v("大家好，我是鱼皮。")]),a._v(" "),n("p",[a._v("我的老弟小阿巴最近不是在某公司实习嘛，前两天我问他：老弟，最近实习感觉如何？学到什么东西了不？")]),a._v(" "),n("p",[a._v("小阿巴笑容满面地说：我最近自己独立手写了一个类库！")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080940493.png",loading:"lazy"}})]),a._v(" "),n("p",[a._v("我惊叹道：厉害呀，你不是才刚进公司嘛？就已经开始自己造轮子了？")]),a._v(" "),n("p",[a._v("小阿巴：嘿嘿，只是把公司项目的加密模块封装了一下，导师还夸奖了我。")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080940758.png",loading:"lazy"}})]),a._v(" "),n("p",[a._v("我：不错不错，现在绝大多数刚进公司的同学都是跟着导师指哪儿打哪儿，你的这个自主操作还是非常加分的。那能不能分享一下你是怎么开发的这个类库呀？")]),a._v(" "),n("p",[a._v("小阿巴：我是用了 Java Spring Boot 框架开发了一个 "),n("strong",[a._v("starter")]),a._v(" 。")]),a._v(" "),n("p",[a._v("我：啥是 starter 啊？直接写个工具类还不行？")]),a._v(" "),n("p",[a._v("小阿巴：我们在做 Spring Boot 项目的时候不是经常会引入各种 starter 么？比如操作数据库的 mybatis-starter、接入接口文档的 knife4j-starter 等等。引入 starter 的好处是可以快速地将第三方库整合到我们的项目中，只要在 application.yml 配置文件中写配置，就能自动创建对象实例完成操作。")]),a._v(" "),n("p",[a._v("我：原来如此，那怎么开发一个 starter 呢？")]),a._v(" "),n("p",[a._v("小阿巴（一脸难以置信）：不是吧老鱼皮，这次竟然轮到我来教教你了。")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080940488.png",loading:"lazy"}})]),a._v(" "),n("p",[a._v("小阿巴：那我就来分享一下。如今网上的手写 starter 教程虽然不少，但是乱七八糟的，很多博客都是各种坑，下面我用最短的时间给大家分享手写 starter 的完整流程。")]),a._v(" "),n("h2",{attrs:{id:"手写-spring-boot-starter"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#手写-spring-boot-starter"}},[a._v("#")]),a._v(" 手写 Spring Boot Starter")]),a._v(" "),n("p",[a._v("首先我们用 IDEA 开发工具来初始化一个 Spring Boot 项目，注意 Java 版本不要选太高、Spring Boot 版本不要选 3.x：")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080940647.png",loading:"lazy"}})]),a._v(" "),n("p",[a._v("初始化项目后，我们要在项目依赖文件 pom.xml 中引入几个核心依赖：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-autoconfigure</artifactId>\n</dependency>\n<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-configuration-processor</artifactId>\n  <optional>true</optional>\n</dependency>\n<dependency>\n  <groupId>org.projectlombok</groupId>\n  <artifactId>lombok</artifactId>\n  <optional>true</optional>\n</dependency>\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br")])]),n("p",[a._v("其中，spring-boot-autoconfigure 用于自动加载配置，spring-boot-configuration-processor 用于自动生成配置文件的自动提示。")]),a._v(" "),n("p",[a._v("有这些依赖就足够了，我们尽量保证 starter 的精简，便于其他项目引用时的兼容性。")]),a._v(" "),n("p",[n("strong",[a._v("此外，还要把 pom.xml 中的下面这段代码删掉：")])]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("<build>\n  <plugins>\n    <plugin>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-maven-plugin</artifactId>\n    </plugin>\n  </plugins>\n</build>\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br")])]),n("p",[a._v("接下来，假设我们已经开发了一个 Client（实现了主要功能的类），我们要编写一个配置类，用于自动创建 Client 实例。")]),a._v(" "),n("p",[a._v("这里我用最近在带大家开发的 "),n("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzI1NDczNTAwMA==&mid=2247529515&idx=1&sn=eb5e2af507ce35e3c4159dad7e1424f1&chksm=e9c293dcdeb51acac148fd14c0677ab3c1076c47ab52a33ffe7d682a3e1d1d8f37c4d3c7d167&token=1411297570&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[a._v("API 开放平台项目"),n("OutboundLink")],1),a._v(" 为例，创建了一个自动调用接口的 API 客户端实例，参考代码如下：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('@Configuration\n@ConfigurationProperties(prefix = "yuapi.client")\n@Data\n@ComponentScan\npublic class YuApiClientConfig {\n\n    /**\n     * appId\n     */\n    private String appId;\n\n    /**\n     * 秘钥\n     */\n    private String appSecret;\n\n    @Bean\n    public YuApiClient yuApiClient() {\n        return new YuApiClient(appId, appSecret, userId);\n    }\n}\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br")])]),n("p",[a._v("上述代码中，比较关键的注解是：")]),a._v(" "),n("ul",[n("li",[a._v("@Configuration：告诉 Spring Boot 这是一个配置类，可以在该类中创建 Bean")]),a._v(" "),n("li",[a._v("@ConfigurationProperties：和配置文件（一般是 application.yml）进行绑定，将配置文件中对应的配置映射到对象的属性中。比如 application.yml 中 yuapi.client.appId 的值会自动注入到 YuApiClientConfig 实例的 appId 属性。不用再把值硬编码到类中了！")])]),a._v(" "),n("p",[a._v("写完这个配置类后，还要把它进行注册，创建一个配置文件 "),n("code",[a._v("resources/META_INF/spring.factories")]),a._v(" ，编写如下代码：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# spring boot starter\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=com.yupi.mystarter.YuApiClientConfig\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("这样，就相当于给了项目一个启动入口（类似 main）。")]),a._v(" "),n("p",[a._v("然后，我们的 stater 类库就编写完毕啦！执行 mvn install 命令，就可以把它打包为本地依赖，供其他项目使用。")]),a._v(" "),n("p",[a._v("比如：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("<dependency>\n  <groupId>com.yupi</groupId>\n  <artifactId>my-starter</artifactId>\n  <version>0.0.1</version>\n</dependency>\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("p",[a._v("你学会了么？")]),a._v(" "),n("hr"),a._v(" "),n("p",[a._v("我：学废了学废了。我们是不是还可以把自己开发好的类库上传到 Maven 软件源上给其他同学公开使用？")]),a._v(" "),n("p",[a._v("小阿巴：Right Bro~ 我正打算这么做，把这段经历写到简历上，相信会比我之前只写管理系统项目加分得多！")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pic.yupi.icu/5563/202311080940496.png",loading:"lazy"}})]),a._v(" "),n("h2",{attrs:{id:"完"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#完"}},[a._v("#")]),a._v(" 完")]),a._v(" "),n("p",[a._v("在鱼皮最新带大家直播开发的 "),n("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzI1NDczNTAwMA==&mid=2247529515&idx=1&sn=eb5e2af507ce35e3c4159dad7e1424f1&chksm=e9c293dcdeb51acac148fd14c0677ab3c1076c47ab52a33ffe7d682a3e1d1d8f37c4d3c7d167&token=1411297570&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[a._v("API 开放平台项目"),n("OutboundLink")],1),a._v(" 中，也手把手带大家做了一个 Starter 类库，还分享了开发第三方类库的经验，感兴趣的同学欢迎加入我的 "),n("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzI1NDczNTAwMA==&mid=2247524980&idx=2&sn=9ddcdb6c52aa096ed4c5ad0ced946a7d&chksm=e9c28583deb50c95f3c2665713a8bbc372c68332b3bfb846cf4b23af3f1cc07164832a291335&token=689599617&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[a._v("编程知识星球"),n("OutboundLink")],1),a._v(" 参与。除了直播带大家开发完整项目外，我会 1 对 1 解决你的问题。可以加微信 yupi5927，备注【加入星球】和自己的情况领取优惠加入星球，不备注不通过，非诚勿扰谢谢。")])])}),[],!1,null,null,null);n.default=e.exports}}]);